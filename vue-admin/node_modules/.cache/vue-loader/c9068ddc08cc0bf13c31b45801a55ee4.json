{"remainingRequest":"C:\\Users\\97154\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\97154\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-admin\\src\\views\\blindBoxManagement\\blindBox.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\97154\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-admin\\src\\views\\blindBoxManagement\\blindBox.vue","mtime":1650964597000},{"path":"C:\\Users\\97154\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1652081880827},{"path":"C:\\Users\\97154\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1652081856293},{"path":"C:\\Users\\97154\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1652081880827},{"path":"C:\\Users\\97154\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1652081880134}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBQYWdpbmF0aW9uIGZyb20gIkAvY29tcG9uZW50cy9QYWdpbmF0aW9uIjsKaW1wb3J0IGJveFNldCBmcm9tICIuL2JsaW5kQm94U2V0IjsKaW1wb3J0IE1lZGlhIGZyb20gIkAvY29tcG9uZW50cy9NZWRpYSI7CmltcG9ydCB3ZWIzIGZyb20gJ0AvdXRpbHMvd2ViMy9pbmRleCc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiYmxpbmRCb3giLAogIGNvbXBvbmVudHM6IHsgUGFnaW5hdGlvbiwgYm94U2V0LCBNZWRpYSB9LAogIGRhdGEgKCkgewogICAgdmFyIHZhbGlkYXRlUHJpY2UgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgIGlmICh0aGlzLnBheVR5cGUgPT09IDIpIHsKICAgICAgICBpZiAocGFyc2VJbnQodmFsdWUpICE9PSBwYXJzZUZsb2F0KHZhbHVlKSkgewogICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKHRoaXMuJHQoImJsaW5kLmJveC5pbnRlZ2VyIikpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2FsbGJhY2soKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FsbGJhY2soKTsKICAgICAgfQogICAgfTsKICAgIHJldHVybiB7CiAgICAgIGxpc3Q6IG51bGwsCiAgICAgIHRvdGFsOiAwLAogICAgICBsaXN0TG9hZGluZzogZmFsc2UsCiAgICAgIGFwaUxvYWRpbmc6IGZhbHNlLAogICAgICBsaXN0UXVlcnk6IHsKICAgICAgICBwYWdlOiAxLAogICAgICAgIGxpbWl0OiAxMCwKICAgICAgICBzb3J0OiAiY3JlYXRlX3RpbWUiLAogICAgICAgIG9yZGVyOiAiZGVzYyIsCiAgICAgICAgYmxpbmRUeXBlTmFtZTogdW5kZWZpbmVkLAogICAgICAgIHN5bmM6IHVuZGVmaW5lZCwKICAgICAgfSwKICAgICAgc3luY09wdGlvbnM6IFsKICAgICAgICB7CiAgICAgICAgICB2YWx1ZTogdHJ1ZSwKICAgICAgICAgIGxhYmVsOiB0aGlzLiR0KCJibGluZC5zeW5jIiksCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB2YWx1ZTogZmFsc2UsCiAgICAgICAgICBsYWJlbDogdGhpcy4kdCgiYmxpbmQudW5zeW5jIiksCiAgICAgICAgfSwKICAgICAgXSwKICAgICAgZGlhbG9nRm9ybVZpc2libGU6IGZhbHNlLAogICAgICBkaWFsb2dTdGF0dXM6ICIiLAogICAgICBlcnJvcjogIiIsCiAgICAgIGZvcm1EYXRhOiB7CiAgICAgICAgYWRkcmVzczogIiIsCiAgICAgICAgbmFtZTogIiIsCiAgICAgICAgZGVzY3JpYmU6ICIiLAogICAgICAgIG93bmVyOiAiIiwKICAgICAgICB0aW1lczogW10sCiAgICAgICAgaXNSZXBldGl0aW9uOiBmYWxzZSwKICAgICAgICBhbW91bnQ6ICIiLAogICAgICAgIG5mdEFtb3VudDogIiIsCiAgICAgICAgcHJpY2U6ICIiLAogICAgICAgIHBheXRva2VuSWQ6ICIiLAogICAgICAgIGltZ0lkOiAiIiwKICAgICAgICBpbWdVcmw6ICIiLAogICAgICAgIGFuaW0xOiAiIiwKICAgICAgICBhbmltMjogIiIsCiAgICAgIH0sCiAgICAgIHBheXRva2VuczogW10sCiAgICAgIHJ1bGVzOiB7CiAgICAgICAgYWRkcmVzczogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogdGhpcy4kdCgiYmxpbmQuYm94LmVtcHR5VHlwZSIpLAogICAgICAgICAgICB0cmlnZ2VyOiAiYmx1ciIsCiAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgbmFtZTogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogdGhpcy4kdCgiYmxpbmQuYm94LmVtcHR5TmFtZSIpLAogICAgICAgICAgICB0cmlnZ2VyOiAiYmx1ciIsCiAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgb3duZXI6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoImJsaW5kLmJveC5lbXB0eU93bmVyIiksCiAgICAgICAgICAgIHRyaWdnZXI6ICJibHVyIiwKICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICAgICBwYXl0b2tlbklkOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCJibGluZC5ib3guZW1wdHlQYXlUb2tlbiIpLAogICAgICAgICAgICB0cmlnZ2VyOiAiYmx1ciIsCiAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgYW1vdW50OiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCJibGluZC5ib3gubGltaXRBbW91bnQiKSwKICAgICAgICAgICAgdHJpZ2dlcjogImJsdXIiLAogICAgICAgICAgfSwKICAgICAgICBdLAogICAgICAgIG5mdEFtb3VudDogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogdGhpcy4kdCgiYmxpbmQuYm94LmVtcHR5T3BlbkFtb3VudCIpLAogICAgICAgICAgICB0cmlnZ2VyOiAiYmx1ciIsCiAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgcHJpY2U6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoImJsaW5kLmJveC5saW1pdFByaWNlIiksCiAgICAgICAgICAgIHRyaWdnZXI6ICJibHVyIiwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIHZhbGlkYXRvcjogdmFsaWRhdGVQcmljZSwKICAgICAgICAgICAgdHJpZ2dlcjogImJsdXIiLAogICAgICAgICAgfSwKICAgICAgICBdLAogICAgICAgIGltZ1VybDogewogICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCJibGluZC5ib3guZW1wdHlQaWN0dXJlIiksCiAgICAgICAgICB0cmlnZ2VyOiAiY2hhbmdlIiwKICAgICAgICB9LAogICAgICAgIHRpbWVzOiB7CiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoImJsaW5kLmJveC5lbXB0eVRpbWVzIiksCiAgICAgICAgICB0cmlnZ2VyOiAiY2hhbmdlIiwKICAgICAgICB9LAogICAgICB9LAogICAgICBwaWNrZXJPcHRpb25zOiB7CiAgICAgICAgZGlzYWJsZWREYXRlICh0aW1lKSB7CiAgICAgICAgICByZXR1cm4gdGltZS5nZXRUaW1lKCkgPCBEYXRlLm5vdygpIC0gOC42NGU3OwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVsZXRlSWQ6ICIiLAogICAgICBib3g6IG51bGwsCiAgICAgIGZpbGVJbWFnZTogIiIsCiAgICAgIGZpbGVsaXN0OiBbXSwKICAgICAgYW5pbTFJbWFnZTogIiIsCiAgICAgIGFuaW0xTGlzdDogW10sCiAgICAgIGFuaW0ySW1hZ2U6ICIiLAogICAgICBhbmltMkxpc3Q6IFtdLAogICAgICAvLyDmjojmnYMKICAgICAgYmxpbmRCb3hJZDogIiIsCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGRpYWxvZ1RpdGxlICgpIHsKICAgICAgbGV0IGRpYWxvZ1RpdGxlID0gIiI7CiAgICAgIHN3aXRjaCAodGhpcy5kaWFsb2dTdGF0dXMpIHsKICAgICAgICBjYXNlICJhZGQiOgogICAgICAgICAgZGlhbG9nVGl0bGUgPSB0aGlzLiR0KCJibGluZC5hZGQiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImVkaXQiOgogICAgICAgICAgZGlhbG9nVGl0bGUgPSB0aGlzLiR0KCJibGluZC5lZGl0Iik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJkZWwiOgogICAgICAgICAgZGlhbG9nVGl0bGUgPSB0aGlzLiR0KCJibGluZC5kZWxldGUiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICByZXR1cm4gZGlhbG9nVGl0bGU7CiAgICB9LAogICAgY29ubmVjdGVkKCl7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5uZXR3b3JrLmNvbm5lY3RlZDsKICAgIH0sCiAgICB3ZWIzKCl7CiAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5uZXR3b3JrLndlYjM7CiAgICB9LAogICAgY29uZmlnICgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnVzZXIuY29uZmlnOwogICAgfSwKICAgIGJsaW5kVHlwZXMgKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUudXNlci5ibGluZFR5cGVzOwogICAgfSwKICAgIHRhYmxlQmxpbmRUeXBlICgpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhZGRyZXNzKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuYmxpbmRUeXBlcy5sZW5ndGg7aSA8IGxlbjtpKyspIHsKICAgICAgICAgIGlmICh0aGlzLmJsaW5kVHlwZXNbaV0uYWRkcmVzcyA9PT0gYWRkcmVzcykKICAgICAgICAgICAgcmV0dXJuIHRoaXMuYmxpbmRUeXBlc1tpXS5uYW1lOwogICAgICAgIH0KICAgICAgfTsKICAgIH0sCiAgICB0YWJsZVRpbWUgKCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHsKICAgICAgICBsZXQgYWN0aXZlRGF0ZSA9ICIiOwogICAgICAgIGlmIChzdGFydCAmJiBlbmQpIHsKICAgICAgICAgIGxldCBzdGFydERhdGUgPSBuZXcgRGF0ZShzdGFydCAqIDEwMDApLAogICAgICAgICAgICBzdGFydERhdGVfZGF0ZSA9IHN0YXJ0RGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKSwKICAgICAgICAgICAgc3RhcnREYXRlX3RpbWUgPSBzdGFydERhdGUudG9UaW1lU3RyaW5nKCkuc2xpY2UoMCwgOCksCiAgICAgICAgICAgIGVuZERhdGUgPSBuZXcgRGF0ZShlbmQgKiAxMDAwKSwKICAgICAgICAgICAgZW5kRGF0ZV9kYXRlID0gZW5kRGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKSwKICAgICAgICAgICAgZW5kRGF0ZV90aW1lID0gZW5kRGF0ZS50b1RpbWVTdHJpbmcoKS5zbGljZSgwLCA4KTsKICAgICAgICAgIGFjdGl2ZURhdGUgPQogICAgICAgICAgICBzdGFydERhdGVfZGF0ZSArCiAgICAgICAgICAgICIgIiArCiAgICAgICAgICAgIHN0YXJ0RGF0ZV90aW1lICsKICAgICAgICAgICAgIuS4gCIgKwogICAgICAgICAgICBlbmREYXRlX2RhdGUgKwogICAgICAgICAgICAiICIgKwogICAgICAgICAgICBlbmREYXRlX3RpbWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhY3RpdmVEYXRlOwogICAgICB9OwogICAgfSwKICAgIHBheVR5cGUgKCkgewogICAgICBmb3IgKGxldCBpdGVtIG9mIHRoaXMucGF5dG9rZW5zKSB7CiAgICAgICAgaWYgKGl0ZW0uaWQgPT09IHRoaXMuZm9ybURhdGEucGF5dG9rZW5JZCkgewogICAgICAgICAgcmV0dXJuIGl0ZW0udHlwZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGwKICAgIH0sCiAgICB0b3RhbEFtb3VudCAoKSB7CiAgICAgIGlmICghdGhpcy5mb3JtRGF0YS5uZnRBbW91bnQgfHwgIXRoaXMuZm9ybURhdGEuYW1vdW50KSByZXR1cm4gMDsKICAgICAgbGV0IGFtb3VudCA9IHBhcnNlSW50KHRoaXMuZm9ybURhdGEubmZ0QW1vdW50ICogdGhpcy5mb3JtRGF0YS5hbW91bnQpCiAgICAgIHJldHVybiAhYW1vdW50ID8gMCA6IGFtb3VudDsKICAgIH0sCiAgfSwKICBjcmVhdGVkICgpIHsKICAgIHRoaXMuaW5pdCgpOwogIH0sCiAgbWV0aG9kczogewogICAgY29ubmVjdFdhbGxldCgpewogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgiY29ubmVjdCIpOwogICAgfSwKICAgIG9uQ29uZmlybSAoKSB7CiAgICAgIHRoaXMuZGlhbG9nRm9ybVZpc2libGUgPSBmYWxzZTsKICAgICAgdGhpcy5nZXRMaXN0KCk7CiAgICB9LAogICAgaW5pdCgpewogICAgICB0aGlzLnBheXRva2VuTGlzdCgpOwogICAgICB0aGlzLmdldExpc3QoKTsKICAgIH0sCiAgICBwYXl0b2tlbkxpc3QoKXsKICAgICAgdGhpcy4kYXBpKCJibGluZC5wYXl0b2tlbi5saXN0IikudGhlbihyZXMgPT4gewogICAgICAgIGlmKHRoaXMuJHRvb2wuY2hlY2tSZXNwb25zZShyZXMpKXsKICAgICAgICAgIHRoaXMucGF5dG9rZW5zID0gcmVzLmRhdGEubGlzdDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGdldExpc3QgKCkgewogICAgICB0aGlzLmxpc3RMb2FkaW5nID0gdHJ1ZTsKICAgICAgdGhpcy4kYXBpKCJibGluZC5ib3gubGlzdCIsIHRoaXMubGlzdFF1ZXJ5KQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMubGlzdCA9IHJlcy5kYXRhLmxpc3Q7CiAgICAgICAgICB0aGlzLmdldE5mdExpc3QoKTsKICAgICAgICAgIHRoaXMudG90YWwgPSByZXMuZGF0YS50b3RhbDsKICAgICAgICAgIHRoaXMubGlzdExvYWRpbmcgPSBmYWxzZTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICB0aGlzLmxpc3QgPSBbXTsKICAgICAgICAgIHRoaXMudG90YWwgPSAwOwogICAgICAgICAgdGhpcy5saXN0TG9hZGluZyA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIGdldE5mdExpc3QoKXsKICAgICAgdmFyIGJveExpc3QgPSBbXTsKICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHRoaXMubGlzdC5sZW5ndGg7IGkrKyl7CiAgICAgICAgYm94TGlzdC5wdXNoKHRoaXMubGlzdFtpXS5pZCk7CiAgICAgIH0KICAgICAgYm94TGlzdCA9IGJveExpc3Quam9pbigiLCIpOwogICAgICB0aGlzLiRhcGkoImJsaW5kLmJveC5uZnRzYnltdWx0aSIsICB7IGJveExpc3QgfSkudGhlbihyZXMgPT4gewogICAgICAgIGlmKHRoaXMuJHRvb2wuY2hlY2tSZXNwb25zZShyZXMpKXsKICAgICAgICAgIHZhciBuZnRzID0gcmVzLmRhdGEubGlzdDsKICAgICAgICAgIHZhciBhbW91bnREaWN0ID0ge307CiAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgbmZ0cy5sZW5ndGg7IGkrKyl7CiAgICAgICAgICAgIHZhciBuZnQgPSBuZnRzW2ldOwogICAgICAgICAgICBpZighYW1vdW50RGljdFtuZnQuYmxpbmRCb3hJZF0pIGFtb3VudERpY3RbbmZ0LmJsaW5kQm94SWRdID0gMDsKICAgICAgICAgICAgYW1vdW50RGljdFtuZnQuYmxpbmRCb3hJZF0gKz0gbmZ0LmFtb3VudDsKICAgICAgICAgIH0KICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0aGlzLmxpc3QubGVuZ3RoOyBpKyspewogICAgICAgICAgICB2YXIgdXNlZEFtb3VudCA9IGFtb3VudERpY3RbdGhpcy5saXN0W2ldLmlkXTsKICAgICAgICAgICAgdGhpcy5saXN0W2ldLnVzZWRBbW91bnQgPSB1c2VkQW1vdW50ID8gdXNlZEFtb3VudCA6IDA7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLmxpc3QgPSBbXS5jb25jYXQodGhpcy5saXN0KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKICAgIGNoZWNrRm9ybSAoKSB7CiAgICAgIGxldCBlcnJvciA9IGZhbHNlOwogICAgICBsZXQgYW1vdW50ID0gcGFyc2VJbnQodGhpcy5mb3JtRGF0YS5hbW91bnQpOwogICAgICBpZiAoIWFtb3VudCB8fCBhbW91bnQgPCAxKSB7CiAgICAgICAgdGhpcy5lcnJvciA9IHRoaXMuJHQoJ2JsaW5kLmJveC5saW1pdEFtb3VudCcpCiAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICB9CiAgICAgIGxldCBuZnRBbW91bnQgPSBwYXJzZUludCh0aGlzLmZvcm1EYXRhLm5mdEFtb3VudCk7CiAgICAgIGlmICghbmZ0QW1vdW50IHx8IG5mdEFtb3VudCA8IDEpIHsKICAgICAgICB0aGlzLmVycm9yID0gdGhpcy4kdCgnYmxpbmQuYm94LmxpbWl0T3BlbkFtb3VudCcpCiAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICB9CiAgICAgIGxldCBwcmljZSA9IHBhcnNlRmxvYXQodGhpcy5mb3JtRGF0YS5wcmljZSk7CiAgICAgIGlmICghcHJpY2UgfHwgcHJpY2UgPCAwKSB7CiAgICAgICAgdGhpcy5lcnJvciA9IHRoaXMuJHQoJ2JsaW5kLmJveC5saW1pdFByaWNlJykKICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmZpbGVJbWFnZSAmJiAhdGhpcy5mb3JtRGF0YS5pbWdJZCkgewogICAgICAgIHRoaXMuZXJyb3IgPSB0aGlzLiR0KCdibGluZC5ib3guZW1wdHlDb3ZlcicpCiAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICB9CiAgICAgIHJldHVybiAhZXJyb3I7CiAgICB9LAogICAgYWRkQm94IChkYXRhKSB7CiAgICAgIGxldCB7CiAgICAgICAgYWRkcmVzcywKICAgICAgICBuYW1lLAogICAgICAgIGRlc2NyaWJlLAogICAgICAgIG93bmVyLAogICAgICAgIHRpbWVzLAogICAgICAgIGlzUmVwZXRpdGlvbiwKICAgICAgICBhbW91bnQsCiAgICAgICAgbmZ0QW1vdW50LAogICAgICAgIHByaWNlLAogICAgICAgIHBheXRva2VuSWQsCiAgICAgICAgaW1nSWQsCiAgICAgICAgaW1nVXJsLAogICAgICAgIGFuaW0xLAogICAgICAgIGFuaW0yLAogICAgICB9ID0gdGhpcy5mb3JtRGF0YTsKICAgICAgbGV0IHN0YXJ0VGltZSA9ICF0aW1lc1swXSA/IDAKICAgICAgICA6IHBhcnNlSW50KG5ldyBEYXRlKHRpbWVzWzBdKS5nZXRUaW1lKCkgLyAxMDAwKTsKICAgICAgbGV0IGVuZFRpbWUgPSAhdGltZXNbMV0gPyAwCiAgICAgICAgOiBwYXJzZUludChuZXcgRGF0ZSh0aW1lc1sxXSkuZ2V0VGltZSgpIC8gMTAwMCk7CiAgICAgIGlmIChkYXRhLmNvdmVyKSB7CiAgICAgICAgaW1nSWQgPSBkYXRhLmNvdmVyLmlkOwogICAgICAgIGltZ1VybCA9IGRhdGEuY292ZXIudXJsOwogICAgICB9CiAgICAgIGlmIChkYXRhLmFuaW0xKSBhbmltMSA9IGRhdGEuYW5pbTEudXJsOwoKICAgICAgaWYgKGRhdGEuYW5pbTIpIGFuaW0yID0gZGF0YS5hbmltMi51cmw7CgogICAgICBsZXQgc2VuZERhdGEgPSB7CiAgICAgICAgYWRkcmVzcywKICAgICAgICBuYW1lLAogICAgICAgIGRlc2NyaWJlLAogICAgICAgIG93bmVyLAogICAgICAgIHN0YXJ0VGltZSwKICAgICAgICBlbmRUaW1lLAogICAgICAgIGlzUmVwZXRpdGlvbiwKICAgICAgICBhbW91bnQsCiAgICAgICAgbmZ0QW1vdW50LAogICAgICAgIHByaWNlLAogICAgICAgIHBheXRva2VuSWQsCiAgICAgICAgaW1nSWQsCiAgICAgICAgaW1nVXJsLAogICAgICAgIGFuaW0xLAogICAgICAgIGFuaW0yLAogICAgICB9OwogICAgICB0aGlzLmFwaUxvYWRpbmcgPSB0cnVlOwogICAgICB0aGlzLiRhcGkoImJsaW5kLmJveC5hZGQiLCBzZW5kRGF0YSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmFwaUxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmICh0aGlzLiR0b29sLmNoZWNrUmVzcG9uc2UocmVzKSkgewogICAgICAgICAgICB0aGlzLnN1Y2Nlc3NDYWxsYmFjaygpOwogICAgICAgICAgICB0aGlzLmdldExpc3QoKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgICB0aGlzLmZhaWxDYWxsYmFjayhlcnIpOwogICAgICAgIH0pOwogICAgfSwKICAgIGVkaXRCb3ggKGRhdGEpIHsKICAgICAgbGV0IHsgdGltZXMsIGltZ0lkLCBpbWdVcmwsIGFuaW0xLCBhbmltMiB9ID0gdGhpcy5mb3JtRGF0YTsKICAgICAgbGV0IHN0YXJ0VGltZSA9ICF0aW1lc1swXSA/IDAKICAgICAgICA6IHBhcnNlSW50KG5ldyBEYXRlKHRpbWVzWzBdKS5nZXRUaW1lKCkgLyAxMDAwKTsKICAgICAgbGV0IGVuZFRpbWUgPSAhdGltZXNbMV0gPyAwCiAgICAgICAgOiBwYXJzZUludChuZXcgRGF0ZSh0aW1lc1sxXSkuZ2V0VGltZSgpIC8gMTAwMCk7CiAgICAgIGlmIChkYXRhLmNvdmVyKSB7CiAgICAgICAgaW1nSWQgPSBkYXRhLmNvdmVyLmlkOwogICAgICAgIGltZ1VybCA9IGRhdGEuY292ZXIudXJsOwogICAgICB9CiAgICAgIGlmIChkYXRhLmFuaW0xKSB7CiAgICAgICAgYW5pbTEgPSBkYXRhLmFuaW0xLnVybDsKICAgICAgfQogICAgICBpZiAoZGF0YS5hbmltMikgewogICAgICAgIGFuaW0yID0gZGF0YS5hbmltMi51cmw7CiAgICAgIH0KCiAgICAgIGxldCBzZW5kRGF0YSA9IHsKICAgICAgICBpZDogdGhpcy5mb3JtRGF0YS5pZCwKICAgICAgICBhZGRyZXNzOiB0aGlzLmZvcm1EYXRhLmFkZHJlc3MsCiAgICAgICAgbmFtZTogdGhpcy5mb3JtRGF0YS5uYW1lLAogICAgICAgIGRlc2NyaWJlOiB0aGlzLmZvcm1EYXRhLmRlc2NyaWJlLAogICAgICAgIG93bmVyOiB0aGlzLmZvcm1EYXRhLm93bmVyLAogICAgICAgIGlzUmVwZXRpdGlvbjogdGhpcy5mb3JtRGF0YS5pc1JlcGV0aXRpb24sCiAgICAgICAgYW1vdW50OiB0aGlzLmZvcm1EYXRhLmFtb3VudCwKICAgICAgICBuZnRBbW91bnQ6IHRoaXMuZm9ybURhdGEubmZ0QW1vdW50LAogICAgICAgIHByaWNlOiB0aGlzLmZvcm1EYXRhLnByaWNlLAogICAgICAgIHBheXRva2VuSWQ6IHRoaXMuZm9ybURhdGEucGF5dG9rZW5JZCwKICAgICAgICBzdGFydFRpbWUsCiAgICAgICAgZW5kVGltZSwKICAgICAgICBpbWdJZCwKICAgICAgICBpbWdVcmwsCiAgICAgICAgYW5pbTEsCiAgICAgICAgYW5pbTIsCiAgICAgIH07CiAgICAgIHRoaXMuYXBpTG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMuJGFwaSgiYmxpbmQuYm94LmVkaXQiLCBzZW5kRGF0YSkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICB0aGlzLmFwaUxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIGlmICh0aGlzLiR0b29sLmNoZWNrUmVzcG9uc2UocmVzKSkgewogICAgICAgICAgICB0aGlzLnN1Y2Nlc3NDYWxsYmFjaygpOwogICAgICAgICAgICB0aGlzLmdldExpc3QoKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7CiAgICAgICAgICB0aGlzLmZhaWxDYWxsYmFjayhlcnIpOwogICAgICAgIH0pOwogICAgfSwKICAgIGRlbEJveCAoKSB7CiAgICAgIHRoaXMuYXBpTG9hZGluZyA9IHRydWU7CiAgICAgIHRoaXMuJGFwaSgiYmxpbmQuYm94LmRlbGV0ZWQiLCB7IGlkOiB0aGlzLmRlbGV0ZUlkIH0pCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgdGhpcy5hcGlMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBpZiAodGhpcy4kdG9vbC5jaGVja1Jlc3BvbnNlKHJlcykpIHsKICAgICAgICAgICAgdGhpcy5zdWNjZXNzQ2FsbGJhY2soKTsKICAgICAgICAgICAgbGV0IHsgcGFnZSwgbGltaXQgfSA9IHRoaXMubGlzdFF1ZXJ5OwogICAgICAgICAgICBpZiAocGFnZSA+IDEgJiYgdGhpcy50b3RhbCAtIDEgLSAocGFnZSAtIDEpICogbGltaXQgPD0gMCkgewogICAgICAgICAgICAgIHRoaXMubGlzdFF1ZXJ5LnBhZ2UgLT0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnRvdGFsIC09IDE7CiAgICAgICAgICAgIHRoaXMuZ2V0TGlzdCgpOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnIpID0+IHsKICAgICAgICAgIHRoaXMuZmFpbENhbGxiYWNrKGVycik7CiAgICAgICAgfSk7CiAgICB9LAogICAgcHJlcGFyZVNpZ24oKXsKICAgICAgdGhpcy5hcGlMb2FkaW5nID0gdHJ1ZTsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdGhpcy4kYXBpKCJibGluZC5ib3gucHJlcGFyZSIsIHsKICAgICAgICBpZDogdGhpcy5ibGluZEJveElkLAogICAgICAgIG93bmVyOiB0aGlzLndlYjMuY29pbmJhc2UsCiAgICAgIH0pLnRoZW4oYXN5bmMgZnVuY3Rpb24ocmVzKXsKICAgICAgICBfdGhpcy5hcGlMb2FkaW5nID0gZmFsc2U7CiAgICAgICAgaWYoX3RoaXMuJHRvb2wuY2hlY2tSZXNwb25zZShyZXMpKXsKICAgICAgICAgIHZhciBvcmRlciA9IHJlcy5kYXRhOwogICAgICAgICAgdmFyIG1lc3NhZ2UgPSBvcmRlci5tZXNzYWdlOwogICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UucmVwbGFjZSgiMHgiLCAiIik7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgd2ViMy5zaWduKG1lc3NhZ2UsIF90aGlzLndlYjMuY29pbmJhc2UpOwogICAgICAgICAgaWYocmVzdWx0LmVycm9yKXsKICAgICAgICAgICAgX3RoaXMuZXJyb3IgPSByZXN1bHQuZXJyb3I7CiAgICAgICAgICB9CiAgICAgICAgICBvcmRlci5zaWduYXR1cmUgPSByZXN1bHQ7CiAgICAgICAgICBfdGhpcy5zaWduRGF0YShvcmRlcik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBzaWduRGF0YSAob3JkZXIpIHsKICAgICAgdGhpcy5hcGlMb2FkaW5nID0gdHJ1ZTsKICAgICAgdGhpcy4kYXBpKCJibGluZC5ib3guc2lnbiIsIG9yZGVyKS50aGVuKChyZXMpID0+IHsKICAgICAgICB0aGlzLmFwaUxvYWRpbmcgPSBmYWxzZTsKICAgICAgICBpZiAodGhpcy4kdG9vbC5jaGVja1Jlc3BvbnNlKHJlcykpIHsKICAgICAgICAgIHRoaXMuc3VjY2Vzc0NhbGxiYWNrKCk7CiAgICAgICAgICB0aGlzLmdldExpc3QoKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKChlcnIpID0+IHsKICAgICAgICB0aGlzLmZhaWxDYWxsYmFjayhlcnIpOwogICAgICB9KTsKICAgIH0sCiAgICBzdWNjZXNzQ2FsbGJhY2sgKCkgewogICAgICB0aGlzLiRub3RpZnkuc3VjY2Vzcyh7CiAgICAgICAgdGl0bGU6IHRoaXMuJHQoImJsaW5kLnN1Y2Nlc3MiKSwKICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCJibGluZC5tZXNzYWdlU3VjY2VzcyIpLAogICAgICB9KTsKICAgICAgdGhpcy5oYW5kbGVyQ2FuY2VsKCk7CiAgICB9LAogICAgZmFpbENhbGxiYWNrIChlcnIsIG1zZykgewogICAgICB0aGlzLmFwaUxvYWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy4kbm90aWZ5LmVycm9yKHsKICAgICAgICB0aXRsZTogdGhpcy4kdCgiYmxpbmQuZmFpbCIpLAogICAgICAgIG1lc3NhZ2U6IGVycgogICAgICAgICAgPyAoIW1zZyA/IHRoaXMuJHQoInJlc3BvbnNlLiIgKyBlcnIuZGF0YSA/IGVyci5kYXRhLmVycm5vIDogIiIpIDogbXNnKQogICAgICAgICAgOiB0aGlzLiR0KCJibGluZC5tZXNzYWdlRmFpbCIpLAogICAgICB9KTsKICAgICAgaWYgKHRoaXMuZGlhbG9nU3RhdHVzID09ICJkZWwiIHx8IHRoaXMuZGlhbG9nU3RhdHVzID09ICJzaWduIikgewogICAgICAgIHRoaXMuaGFuZGxlckNhbmNlbCgpOwogICAgICB9CiAgICB9LAogICAgY2FsbGJhY2tDbG9zZURpYWxvZyAoKSB7CiAgICAgIHRoaXMucmVzZXRGb3JtKCk7CiAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLiRyZWZzWyJmb3JtRGF0YSJdID8gdGhpcy4kcmVmc1siZm9ybURhdGEiXS5jbGVhclZhbGlkYXRlKCkgOiAiIjsKICAgICAgfSk7CgogICAgICB0aGlzLmRpYWxvZ1N0YXR1cyA9ICIiOwogICAgICB0aGlzLmVycm9yID0gIiI7CiAgICB9LAogICAgdXBsb2FkQ2hhbmdlIChmaWxlLCBuYW1lKSB7CiAgICAgIHZhciBldmVudCA9IGV2ZW50IHx8IHdpbmRvdy5ldmVudDsKICAgICAgdmFyIGZpbGVzID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgc3dpdGNoIChuYW1lKSB7CiAgICAgICAgY2FzZSAiY292ZXIiOgogICAgICAgICAgdGhpcy5maWxlbGlzdCA9IFtdOwogICAgICAgICAgdGhpcy5maWxlSW1hZ2UgPSBmaWxlLnJhdzsKICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpcy5mb3JtRGF0YS5pbWdVcmwgPSBlLnRhcmdldC5yZXN1bHQ7CiAgICAgICAgICB9OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAib3BlbiI6CiAgICAgICAgICB0aGlzLmFuaW0xTGlzdCA9IFtdOwogICAgICAgICAgdGhpcy5hbmltMUltYWdlID0gZmlsZS5yYXc7CiAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgX3RoaXMuZm9ybURhdGEuYW5pbTEgPSBlLnRhcmdldC5yZXN1bHQ7CiAgICAgICAgICB9OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAib3BlbmVkIjoKICAgICAgICAgIHRoaXMuYW5pbTJMaXN0ID0gW107CiAgICAgICAgICB0aGlzLmFuaW0ySW1hZ2UgPSBmaWxlLnJhdzsKICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBfdGhpcy5mb3JtRGF0YS5hbmltMiA9IGUudGFyZ2V0LnJlc3VsdDsKICAgICAgICAgIH07CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlcyk7CiAgICB9LAogICAgcmVzZXRGb3JtICgpIHsKICAgICAgdGhpcy5mb3JtRGF0YSA9IHsKICAgICAgICBhZGRyZXNzOiAiIiwKICAgICAgICBuYW1lOiAiIiwKICAgICAgICBkZXNjcmliZTogIiIsCiAgICAgICAgdGltZXM6IFtdLAogICAgICAgIGlzUmVwZXRpdGlvbjogZmFsc2UsCiAgICAgICAgYW1vdW50OiAiIiwKICAgICAgICBuZnRBbW91bnQ6ICIiLAogICAgICAgIHByaWNlOiAiIiwKICAgICAgICBwYXl0b2tlbklkOiAiIiwKICAgICAgICBpbWdJZDogIiIsCiAgICAgICAgaW1nVXJsOiAiIiwKICAgICAgICBhbmltMTogIiIsCiAgICAgICAgYW5pbTI6ICIiLAogICAgICB9OwogICAgICB0aGlzLmZpbGVJbWFnZSA9ICIiOwogICAgICB0aGlzLmFuaW0xSW1hZ2UgPSAiIjsKICAgICAgdGhpcy5hbmltMkltYWdlID0gIiI7CiAgICAgIHRoaXMuZXJyb3IgPSAiIjsKICAgIH0sCiAgICBoYW5kbGVyQnRuIChidG5UeXBlLCByb3cgPSB7fSkgewogICAgICBzd2l0Y2ggKGJ0blR5cGUpIHsKICAgICAgICBjYXNlICJhZGQiOgogICAgICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLiRyZWZzWyJmb3JtRGF0YSJdCiAgICAgICAgICAgICAgPyB0aGlzLiRyZWZzWyJmb3JtRGF0YSJdLmNsZWFyVmFsaWRhdGUoKQogICAgICAgICAgICAgIDogIiI7CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImVkaXQiOgogICAgICAgICAgdGhpcy5maWxlSW1hZ2UgPSAiIjsKICAgICAgICAgIHRoaXMuYW5pbTFJbWFnZSA9ICIiOwogICAgICAgICAgdGhpcy5hbmltMkltYWdlID0gIiI7CiAgICAgICAgICB0aGlzLmZvcm1EYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgcm93KTsKICAgICAgICAgIGxldCBzdGFydFRpbWUgPSAhdGhpcy5mb3JtRGF0YS5zdGFydFRpbWUKICAgICAgICAgICAgPyAiIgogICAgICAgICAgICA6IG5ldyBEYXRlKHRoaXMuZm9ybURhdGEuc3RhcnRUaW1lICogMTAwMCk7CiAgICAgICAgICBsZXQgZW5kVGltZSA9ICF0aGlzLmZvcm1EYXRhLmVuZFRpbWUKICAgICAgICAgICAgPyAiIgogICAgICAgICAgICA6IG5ldyBEYXRlKHRoaXMuZm9ybURhdGEuZW5kVGltZSAqIDEwMDApOwogICAgICAgICAgdGhpcy4kc2V0KHRoaXMuZm9ybURhdGEsICJ0aW1lcyIsIFtzdGFydFRpbWUsIGVuZFRpbWVdKTsKICAgICAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy4kcmVmc1siZm9ybURhdGEiXQogICAgICAgICAgICAgID8gdGhpcy4kcmVmc1siZm9ybURhdGEiXS5jbGVhclZhbGlkYXRlKCkKICAgICAgICAgICAgICA6ICIiOwogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJkZWwiOgogICAgICAgICAgdGhpcy5kZWxldGVJZCA9IHJvdy5pZDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInNpZ24iOgogICAgICAgICAgdGhpcy5ibGluZEJveElkID0gcm93LmlkOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic2V0IjoKICAgICAgICAgIHRoaXMuYm94ID0gcm93OwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy5kaWFsb2dGb3JtVmlzaWJsZSA9IHRydWU7CiAgICAgIHRoaXMuZGlhbG9nU3RhdHVzID0gYnRuVHlwZTsKICAgIH0sCiAgICBhc3luYyBoYW5kbGVyQ29uZmlybSAoKSB7CiAgICAgIGlmICh0aGlzLmFwaUxvYWRpbmcpIHJldHVybjsKCiAgICAgIHN3aXRjaCAodGhpcy5kaWFsb2dTdGF0dXMpIHsKICAgICAgICBjYXNlICJhZGQiOgogICAgICAgICAgaWYgKCF0aGlzLmNoZWNrRm9ybSgpKSByZXR1cm47CiAgICAgICAgICB2YXIgZGF0YSA9IHt9OwogICAgICAgICAgaWYgKHRoaXMuZmlsZUltYWdlKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCB0aGlzLnVwbG9hZFN0b3JhZ2UodGhpcy5maWxlSW1hZ2UpOwogICAgICAgICAgICBkYXRhLmNvdmVyID0gcmVzdWx0OwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuYW5pbTFJbWFnZSkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgdGhpcy51cGxvYWRTdG9yYWdlKHRoaXMuYW5pbTFJbWFnZSk7CiAgICAgICAgICAgIGRhdGEuYW5pbTEgPSByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5hbmltMkltYWdlKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCB0aGlzLnVwbG9hZFN0b3JhZ2UodGhpcy5hbmltMkltYWdlKTsKICAgICAgICAgICAgZGF0YS5hbmltMiA9IHJlc3VsdDsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYWRkQm94KGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZWRpdCI6CiAgICAgICAgICBpZiAoIXRoaXMuY2hlY2tGb3JtKCkpIHJldHVybjsKICAgICAgICAgIHZhciBkYXRhID0ge307CiAgICAgICAgICBpZiAodGhpcy5maWxlSW1hZ2UpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IHRoaXMudXBsb2FkU3RvcmFnZSh0aGlzLmZpbGVJbWFnZSk7CiAgICAgICAgICAgIGRhdGEuY292ZXIgPSByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5hbmltMUltYWdlKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCB0aGlzLnVwbG9hZFN0b3JhZ2UodGhpcy5hbmltMUltYWdlKTsKICAgICAgICAgICAgZGF0YS5hbmltMSA9IHJlc3VsdDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmFuaW0ySW1hZ2UpIHsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IHRoaXMudXBsb2FkU3RvcmFnZSh0aGlzLmFuaW0ySW1hZ2UpOwogICAgICAgICAgICBkYXRhLmFuaW0yID0gcmVzdWx0OwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5lZGl0Qm94KGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGVsIjoKICAgICAgICAgIHRoaXMuZGVsQm94KCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzaWduIjoKICAgICAgICAgIHRoaXMuc2lnbkRhdGEoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInNldCI6CiAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgIGlmICh0aGlzLiRyZWZzLmNvbVNldCkgewogICAgICAgICAgICAgIHRoaXMuJHJlZnMuY29tU2V0LmFkZEJveCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAogICAgaGFuZGxlckNhbmNlbCAoKSB7CiAgICAgIHRoaXMuZGlhbG9nRm9ybVZpc2libGUgPSBmYWxzZTsKICAgIH0sCiAgICBhc3luYyB1cGxvYWRTdG9yYWdlIChmaWxlKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICBmb3JtRGF0YS5hcHBlbmQoImZpbGUiLCBmaWxlKTsKICAgICAgICB2YXIgdGhhdCA9IHRoaXM7CiAgICAgICAgdGhpcy4kYXBpKCJzdG9yYWdlLmNyZWF0ZSIsIGZvcm1EYXRhKQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICBpZiAodGhpcy4kdG9vbC5jaGVja1Jlc3BvbnNlKHJlcykpIHsKICAgICAgICAgICAgICByZXNvbHZlKHJlcy5kYXRhKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZWplY3QocmVzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4gewogICAgICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICBoYW5kbGVyRmlsdGVyICgpIHsKICAgICAgdGhpcy5saXN0UXVlcnkucGFnZSA9IDE7CiAgICAgIHRoaXMuZ2V0TGlzdCgpOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["blindBox.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"blindBox.vue","sourceRoot":"src/views/blindBoxManagement","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <div class=\"filter-container\">\n      <el-input v-model=\"listQuery.blindTypeName\" clearable class=\"filter-item w-200 mr-10\" :placeholder=\"$t('blind.placeholder')\" />\n      <el-select v-model=\"listQuery.sync\" class=\"filter-item w-200 mr-10\" :placeholder=\"$t('blind.box.pleaseSelectSync')\" :clearable=\"true\">\n        <el-option v-for=\"item in syncOptions\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\" />\n      </el-select>\n      <el-button class=\"filter-item\" type=\"primary\" icon=\"el-icon-search\" @click=\"handlerFilter\">{{ $t(\"blind.select\") }}</el-button>\n      <el-button class=\"filter-item\" type=\"primary\" icon=\"el-icon-edit\" @click=\"handlerBtn('add')\" v-permission=\"['POST /admin/blind/box/add']\">{{ $t(\"blind.add\") }}</el-button>\n    </div>\n\n    <el-table v-loading=\"listLoading\" :data=\"list\" :element-loading-text=\"$t('util.loadingText')\" border>\n      <el-table-column type=\"expand\">\n        <template slot-scope=\"props\">\n          <el-form label-position=\"left\" inline class=\"table-expand\" label-width=\"160px\">\n            <el-form-item :label=\"$t('blind.box.blindType')\">\n              <span>{{ tableBlindType(props.row.address) }}</span>\n            </el-form-item>\n            <el-form-item label=\"payToken\">\n              <span>{{ props.row.payToken }}</span>\n            </el-form-item>\n            <el-form-item label=\"payTokenId\">\n              <span>{{ props.row.payTokenId }}</span>\n            </el-form-item>\n            <el-form-item :label=\"$t('blind.box.times')\">\n              <span>{{ tableTime(props.row.startTime, props.row.endTime) }}</span>\n            </el-form-item>\n            <el-form-item :label=\"$t('blind.box.anim1')\" v-if=\"props.row.anim1\">\n              <media :url=\"props.row.anim1\" type=\"image\" :isPreview=\"true\"></media>\n            </el-form-item>\n            <el-form-item :label=\"$t('blind.box.anim2')\" v-if=\"props.row.anim2\">\n              <media :url=\"props.row.anim2\" type=\"image\" :isPreview=\"true\"></media>\n            </el-form-item>\n\n            <el-form-item :label=\"$t('blind.box.salt')\">\n              <span>{{ props.row.salt }}</span>\n            </el-form-item>\n          </el-form>\n        </template>\n      </el-table-column>\n\n      <el-table-column prop=\"id\" label=\"ID\" sortable> </el-table-column>\n      <el-table-column prop=\"name\" :label=\"$t('blind.box.name')\">\n      </el-table-column>\n      <el-table-column prop=\"amount\" :label=\"$t('blind.box.amount')\">\n      </el-table-column>\n      <el-table-column prop=\"nftAmount\" :label=\"$t('blind.box.NFTAmount')\">\n      </el-table-column>\n      <el-table-column :label=\"$t('blind.box.NFTListInfo')\" align=\"center\" width=\"200\">\n        <template slot-scope=\"scope\">\n          <div class=\"bfont\" :class=\"!scope.row.isRepetition ? 'cblue' : 'cgreen' \">\n            {{ !scope.row.isRepetition? $t('blind.box.unRepeat') : $t('blind.box.isRepeat') }}\n          </div>\n\n          <div class=\"bfont\" :class=\"scope.row.amount * scope.row.nftAmount != scope.row.usedAmount ? 'cred' : 'cgreen' \">\n            {{$t('blind.box.totalAmount')}}: {{ scope.row.amount * scope.row.nftAmount }}({{ scope.row.usedAmount }})\n          </div>\n          <div class=\"cgreen bfont\" v-if=\"scope.row.amount * scope.row.nftAmount == scope.row.usedAmount\">\n            {{$t('blind.box.success')}}\n          </div>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"price\" :label=\"$t('blind.box.price')\">\n      </el-table-column>\n      <el-table-column width=\"150\" prop=\"imgUrl\" :label=\"$t('blind.box.picture')\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <media :url=\"scope.row.imgUrl\" type=\"image\" :isPreview=\"true\"></media>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"status\" :label=\"$t('blind.status')\" align=\"center\">\n        <template slot-scope=\"scope\">\n          <el-tag type=\"success\" v-if=\"scope.row.sync\">\n            {{ $t(\"blind.sign\") }}\n          </el-tag>\n          <el-tag type=\"info\" v-else>{{ $t(\"blind.unsign\") }}</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column align=\"center\" :label=\"$t('blind.operation')\" width=\"300\" class-name=\"small-padding fixed-width\">\n        <template slot-scope=\"scope\">\n          <el-button type=\"success\" size=\"mini\" @click=\"handlerBtn('set', scope.row)\" v-permission=\"['POST /admin/blind/box/addNfts']\">{{ $t(\"blind.box.config\") }}</el-button>\n          <el-button type=\"primary\" size=\"mini\" @click=\"handlerBtn('edit', scope.row)\" v-permission=\"['POST /admin/blind/box/edit']\">{{ $t(\"blind.edit\") }}</el-button>\n\n          <el-button type=\"primary\" size=\"mini\" @click=\"handlerBtn('sign', scope.row)\" v-permission=\"['POST /admin/blind/box/sign']\">{{ $t(\"blind.box.sign\") }}</el-button>\n\n          <el-button type=\"danger\" size=\"mini\" @click=\"handlerBtn('del', scope.row)\" v-permission=\"['POST /admin/blind/box/deleted']\">{{ $t(\"blind.delete\") }}</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <pagination v-show=\"total > 0\" :total=\"total\" :page.sync=\"listQuery.page\" :limit.sync=\"listQuery.limit\" @pagination=\"getList\" />\n\n    <el-dialog :title=\"dialogTitle\" :visible.sync=\"dialogFormVisible\" :width=\"dialogStatus === 'del' || dialogStatus === 'sync' ? '30%' : '50%'\" @closed=\"callbackCloseDialog\">\n      <template v-if=\"dialogStatus === 'add' || dialogStatus === 'edit'\">\n        <el-form ref=\"formData\" :model=\"formData\" status-icon label-position=\"left\" label-width=\"120px\" :rules=\"rules\">\n          <el-form-item :label=\"$t('blind.box.blindType')\" prop=\"address\">\n            <el-select v-model=\"formData.address\" :placeholder=\"$t('blind.box.pleaseSelect')\">\n              <el-option v-for=\"(blindType, index) in blindTypes\" :key=\"index\" :label=\"blindType.name\" :value=\"blindType.address\">\n              </el-option>\n            </el-select>\n          </el-form-item>\n          <el-form-item :label=\"$t('blind.box.name')\" prop=\"name\">\n            <el-input v-model=\"formData.name\"></el-input>\n          </el-form-item>\n          <el-form-item :label=\"$t('blind.box.brief')\" prop=\"describe\">\n            <el-input type=\"textarea\" v-model=\"formData.describe\"></el-input>\n          </el-form-item>\n\n          <el-form-item :label=\"$t('blind.box.times')\" prop=\"times\">\n            <el-date-picker v-model=\"formData.times\" type=\"datetimerange\" :range-separator=\"$t('blind.time.to')\" :start-placeholder=\"$t('blind.time.start')\" :end-placeholder=\"$t('blind.time.end')\" picker-options=\"pickerOptions\">\n            </el-date-picker>\n          </el-form-item>\n\n          <el-form-item :label=\"$t('blind.box.repetition')\" prop=\"isRepetition\">\n            <el-switch v-model=\"formData.isRepetition\"></el-switch>\n          </el-form-item>\n\n          <el-form-item :label=\"$t('blind.box.amount')\" prop=\"amount\">\n            <el-input-number v-model=\"formData.amount\"></el-input-number>\n          </el-form-item>\n          <el-form-item :label=\"$t('blind.box.NFTAmount')\" prop=\"nftAmount\">\n            <el-input-number v-model=\"formData.nftAmount\"></el-input-number>\n          </el-form-item>\n          <div class=\"form-tip\">{{ $t('blind.box.totalAmount') }} :\n            <span class=\"cblue\"> {{ totalAmount }}</span>\n          </div>\n          <el-form-item :label=\"$t('blind.box.price')\" prop=\"price\">\n            <el-input-number v-model=\"formData.price\" :controls=\"false\"></el-input-number>\n          </el-form-item>\n          <el-form-item :label=\"$t('blind.box.address')\" prop=\"paytokenId\">\n            <el-select v-model=\"formData.paytokenId\" :placeholder=\"$t('blind.box.pleaseSelect')\">\n              <el-option v-for=\"(paytoken, index) in paytokens\" :key=\"index\" :label=\"paytoken.symbol\" :value=\"paytoken.id\">\n              </el-option>\n            </el-select>\n          </el-form-item>\n          <el-form-item :label=\"$t('blind.box.picture')\" prop=\"imgUrl\">\n            <el-upload ref=\"upload\" action=\"\" :auto-upload=\"false\" :show-file-list=\"false\" :file-list=\"filelist\" :limit=\"1\" class=\"avatar-uploader\" accept=\"image/jpg, image/jpeg, image/png, image/gif\" :on-change=\" (file) => { uploadChange(file, 'cover'); }\">\n              <template v-if=\"formData.imgUrl\">\n                <media :url=\"formData.imgUrl\" type=\"image\"></media>\n              </template>\n              <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\n            </el-upload>\n          </el-form-item>\n          <el-form-item :label=\"$t('blind.box.openGif')\" prop=\"anim1\">\n            <el-upload ref=\"upload\" action=\"\" :auto-upload=\"false\" :show-file-list=\"false\" :file-list=\"anim1List\" :limit=\"1\" class=\"avatar-uploader\" accept=\"image/jpg, image/jpeg, image/png, image/gif\" :on-change=\" (file) => { uploadChange(file, 'open');}\">\n              <template v-if=\"formData.anim1\">\n                <media :url=\"formData.anim1\" type=\"image\"></media>\n              </template>\n              <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\n            </el-upload>\n          </el-form-item>\n          <el-form-item :label=\"$t('blind.box.openedGif')\" prop=\"anim2\">\n            <el-upload ref=\"upload\" action=\"\" :auto-upload=\"false\" :show-file-list=\"false\" :file-list=\"anim2List\" :limit=\"1\" class=\"avatar-uploader\" accept=\"image/jpg, image/jpeg, image/png, image/gif\" :on-change=\" (file) => { uploadChange(file, 'opened');}\">\n              <template v-if=\"formData.anim2\">\n                <media :url=\"formData.anim2\" type=\"image\"></media>\n              </template>\n              <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\n            </el-upload>\n          </el-form-item>\n        </el-form>\n      </template>\n      <!-- 删除 -->\n      <template v-if=\"dialogStatus === 'del'\">\n        <span>{{ $t(\"blind.deleteTip\") }}</span>\n      </template>\n      <template v-if=\"dialogStatus === 'sign'\">\n        <p class=\"mb-20\">\n          <span class=\"bfont\"> {{ $t('blind.box.signTip') }} </span>\n        </p>\n        <div class=\"error-tip text-center mb-10\" v-if=\"error\"> {{ error }} </div>\n        <div class=\"mb-20 text-center\">\n          <el-button type=\"warning\" v-if=\"!connected\" @click=\"connectWallet\"> {{ $t(\"global.connectWallet\") }}</el-button>\n          <el-button :loading=\"apiLoading\" type=\"primary\" v-else @click=\"prepareSign\"> {{ $t('blind.box.sign') }}</el-button>\n        </div>\n      </template>\n      <template v-if=\"dialogStatus === 'set'\">\n        <box-set ref=\"comSet\" :box=\"box\" @confirm=\"onConfirm\"></box-set>\n      </template>\n      <!-- 底部按钮 -->\n      <div slot=\"footer\" class=\"flex align-center\" v-if=\"dialogStatus != 'set' && dialogStatus != 'sign'\">\n        <div class=\"\" v-if=\"error\">\n          <span class=\"cred bfont\">{{ error }}</span>\n        </div>\n        <div class=\"flex1\">\n          <el-button @click=\"handlerCancel\">{{ $t(\"blind.cancel\") }}</el-button>\n          <el-button :loading=\"apiLoading\" type=\"primary\" @click.native.prevent=\"handlerConfirm\">{{ $t(\"blind.confirm\") }}</el-button>\n        </div>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\n  import Pagination from \"@/components/Pagination\";\n  import boxSet from \"./blindBoxSet\";\n  import Media from \"@/components/Media\";\n  import web3 from '@/utils/web3/index';\n  export default {\n    name: \"blindBox\",\n    components: { Pagination, boxSet, Media },\n    data () {\n      var validatePrice = (rule, value, callback) => {\n        if (this.payType === 2) {\n          if (parseInt(value) !== parseFloat(value)) {\n            callback(new Error(this.$t(\"blind.box.integer\")));\n          } else {\n            callback();\n          }\n        } else {\n          callback();\n        }\n      };\n      return {\n        list: null,\n        total: 0,\n        listLoading: false,\n        apiLoading: false,\n        listQuery: {\n          page: 1,\n          limit: 10,\n          sort: \"create_time\",\n          order: \"desc\",\n          blindTypeName: undefined,\n          sync: undefined,\n        },\n        syncOptions: [\n          {\n            value: true,\n            label: this.$t(\"blind.sync\"),\n          },\n          {\n            value: false,\n            label: this.$t(\"blind.unsync\"),\n          },\n        ],\n        dialogFormVisible: false,\n        dialogStatus: \"\",\n        error: \"\",\n        formData: {\n          address: \"\",\n          name: \"\",\n          describe: \"\",\n          owner: \"\",\n          times: [],\n          isRepetition: false,\n          amount: \"\",\n          nftAmount: \"\",\n          price: \"\",\n          paytokenId: \"\",\n          imgId: \"\",\n          imgUrl: \"\",\n          anim1: \"\",\n          anim2: \"\",\n        },\n        paytokens: [],\n        rules: {\n          address: [\n            {\n              required: true,\n              message: this.$t(\"blind.box.emptyType\"),\n              trigger: \"blur\",\n            },\n          ],\n          name: [\n            {\n              required: true,\n              message: this.$t(\"blind.box.emptyName\"),\n              trigger: \"blur\",\n            },\n          ],\n          owner: [\n            {\n              required: true,\n              message: this.$t(\"blind.box.emptyOwner\"),\n              trigger: \"blur\",\n            },\n          ],\n          paytokenId: [\n            {\n              required: true,\n              message: this.$t(\"blind.box.emptyPayToken\"),\n              trigger: \"blur\",\n            },\n          ],\n          amount: [\n            {\n              required: true,\n              message: this.$t(\"blind.box.limitAmount\"),\n              trigger: \"blur\",\n            },\n          ],\n          nftAmount: [\n            {\n              required: true,\n              message: this.$t(\"blind.box.emptyOpenAmount\"),\n              trigger: \"blur\",\n            },\n          ],\n          price: [\n            {\n              required: true,\n              message: this.$t(\"blind.box.limitPrice\"),\n              trigger: \"blur\",\n            },\n            {\n              validator: validatePrice,\n              trigger: \"blur\",\n            },\n          ],\n          imgUrl: {\n            required: true,\n            message: this.$t(\"blind.box.emptyPicture\"),\n            trigger: \"change\",\n          },\n          times: {\n            required: true,\n            message: this.$t(\"blind.box.emptyTimes\"),\n            trigger: \"change\",\n          },\n        },\n        pickerOptions: {\n          disabledDate (time) {\n            return time.getTime() < Date.now() - 8.64e7;\n          }\n        },\n        deleteId: \"\",\n        box: null,\n        fileImage: \"\",\n        filelist: [],\n        anim1Image: \"\",\n        anim1List: [],\n        anim2Image: \"\",\n        anim2List: [],\n        // 授权\n        blindBoxId: \"\",\n      };\n    },\n    computed: {\n      dialogTitle () {\n        let dialogTitle = \"\";\n        switch (this.dialogStatus) {\n          case \"add\":\n            dialogTitle = this.$t(\"blind.add\");\n            break;\n          case \"edit\":\n            dialogTitle = this.$t(\"blind.edit\");\n            break;\n          case \"del\":\n            dialogTitle = this.$t(\"blind.delete\");\n            break;\n          default:\n            break;\n        }\n        return dialogTitle;\n      },\n      connected(){\n        return this.$store.state.network.connected;\n      },\n      web3(){\n        return this.$store.state.network.web3;\n      },\n      config () {\n        return this.$store.state.user.config;\n      },\n      blindTypes () {\n        return this.$store.state.user.blindTypes;\n      },\n      tableBlindType () {\n        return function (address) {\n          for (let i = 0, len = this.blindTypes.length;i < len;i++) {\n            if (this.blindTypes[i].address === address)\n              return this.blindTypes[i].name;\n          }\n        };\n      },\n      tableTime () {\n        return function (start, end) {\n          let activeDate = \"\";\n          if (start && end) {\n            let startDate = new Date(start * 1000),\n              startDate_date = startDate.toLocaleDateString(),\n              startDate_time = startDate.toTimeString().slice(0, 8),\n              endDate = new Date(end * 1000),\n              endDate_date = endDate.toLocaleDateString(),\n              endDate_time = endDate.toTimeString().slice(0, 8);\n            activeDate =\n              startDate_date +\n              \" \" +\n              startDate_time +\n              \"一\" +\n              endDate_date +\n              \" \" +\n              endDate_time;\n          }\n          return activeDate;\n        };\n      },\n      payType () {\n        for (let item of this.paytokens) {\n          if (item.id === this.formData.paytokenId) {\n            return item.type;\n          }\n        }\n        return null\n      },\n      totalAmount () {\n        if (!this.formData.nftAmount || !this.formData.amount) return 0;\n        let amount = parseInt(this.formData.nftAmount * this.formData.amount)\n        return !amount ? 0 : amount;\n      },\n    },\n    created () {\n      this.init();\n    },\n    methods: {\n      connectWallet(){\n        this.$store.dispatch(\"connect\");\n      },\n      onConfirm () {\n        this.dialogFormVisible = false;\n        this.getList();\n      },\n      init(){\n        this.paytokenList();\n        this.getList();\n      },\n      paytokenList(){\n        this.$api(\"blind.paytoken.list\").then(res => {\n          if(this.$tool.checkResponse(res)){\n            this.paytokens = res.data.list;\n          }\n        });\n      },\n      getList () {\n        this.listLoading = true;\n        this.$api(\"blind.box.list\", this.listQuery)\n          .then((res) => {\n            this.list = res.data.list;\n            this.getNftList();\n            this.total = res.data.total;\n            this.listLoading = false;\n          })\n          .catch(() => {\n            this.list = [];\n            this.total = 0;\n            this.listLoading = false;\n          });\n      },\n      getNftList(){\n        var boxList = [];\n        for(var i = 0; i < this.list.length; i++){\n          boxList.push(this.list[i].id);\n        }\n        boxList = boxList.join(\",\");\n        this.$api(\"blind.box.nftsbymulti\",  { boxList }).then(res => {\n          if(this.$tool.checkResponse(res)){\n            var nfts = res.data.list;\n            var amountDict = {};\n            for(var i = 0; i < nfts.length; i++){\n              var nft = nfts[i];\n              if(!amountDict[nft.blindBoxId]) amountDict[nft.blindBoxId] = 0;\n              amountDict[nft.blindBoxId] += nft.amount;\n            }\n            for(var i = 0; i < this.list.length; i++){\n              var usedAmount = amountDict[this.list[i].id];\n              this.list[i].usedAmount = usedAmount ? usedAmount : 0;\n            }\n            this.list = [].concat(this.list);\n          }\n        });\n      },\n      checkForm () {\n        let error = false;\n        let amount = parseInt(this.formData.amount);\n        if (!amount || amount < 1) {\n          this.error = this.$t('blind.box.limitAmount')\n          error = true;\n        }\n        let nftAmount = parseInt(this.formData.nftAmount);\n        if (!nftAmount || nftAmount < 1) {\n          this.error = this.$t('blind.box.limitOpenAmount')\n          error = true;\n        }\n        let price = parseFloat(this.formData.price);\n        if (!price || price < 0) {\n          this.error = this.$t('blind.box.limitPrice')\n          error = true;\n        }\n        if (!this.fileImage && !this.formData.imgId) {\n          this.error = this.$t('blind.box.emptyCover')\n          error = true;\n        }\n        return !error;\n      },\n      addBox (data) {\n        let {\n          address,\n          name,\n          describe,\n          owner,\n          times,\n          isRepetition,\n          amount,\n          nftAmount,\n          price,\n          paytokenId,\n          imgId,\n          imgUrl,\n          anim1,\n          anim2,\n        } = this.formData;\n        let startTime = !times[0] ? 0\n          : parseInt(new Date(times[0]).getTime() / 1000);\n        let endTime = !times[1] ? 0\n          : parseInt(new Date(times[1]).getTime() / 1000);\n        if (data.cover) {\n          imgId = data.cover.id;\n          imgUrl = data.cover.url;\n        }\n        if (data.anim1) anim1 = data.anim1.url;\n\n        if (data.anim2) anim2 = data.anim2.url;\n\n        let sendData = {\n          address,\n          name,\n          describe,\n          owner,\n          startTime,\n          endTime,\n          isRepetition,\n          amount,\n          nftAmount,\n          price,\n          paytokenId,\n          imgId,\n          imgUrl,\n          anim1,\n          anim2,\n        };\n        this.apiLoading = true;\n        this.$api(\"blind.box.add\", sendData)\n          .then((res) => {\n            this.apiLoading = false;\n            if (this.$tool.checkResponse(res)) {\n              this.successCallback();\n              this.getList();\n            }\n          })\n          .catch((err) => {\n            this.failCallback(err);\n          });\n      },\n      editBox (data) {\n        let { times, imgId, imgUrl, anim1, anim2 } = this.formData;\n        let startTime = !times[0] ? 0\n          : parseInt(new Date(times[0]).getTime() / 1000);\n        let endTime = !times[1] ? 0\n          : parseInt(new Date(times[1]).getTime() / 1000);\n        if (data.cover) {\n          imgId = data.cover.id;\n          imgUrl = data.cover.url;\n        }\n        if (data.anim1) {\n          anim1 = data.anim1.url;\n        }\n        if (data.anim2) {\n          anim2 = data.anim2.url;\n        }\n\n        let sendData = {\n          id: this.formData.id,\n          address: this.formData.address,\n          name: this.formData.name,\n          describe: this.formData.describe,\n          owner: this.formData.owner,\n          isRepetition: this.formData.isRepetition,\n          amount: this.formData.amount,\n          nftAmount: this.formData.nftAmount,\n          price: this.formData.price,\n          paytokenId: this.formData.paytokenId,\n          startTime,\n          endTime,\n          imgId,\n          imgUrl,\n          anim1,\n          anim2,\n        };\n        this.apiLoading = true;\n        this.$api(\"blind.box.edit\", sendData)\n          .then((res) => {\n            this.apiLoading = false;\n            if (this.$tool.checkResponse(res)) {\n              this.successCallback();\n              this.getList();\n            }\n          })\n          .catch((err) => {\n            this.failCallback(err);\n          });\n      },\n      delBox () {\n        this.apiLoading = true;\n        this.$api(\"blind.box.deleted\", { id: this.deleteId })\n          .then((res) => {\n            this.apiLoading = false;\n            if (this.$tool.checkResponse(res)) {\n              this.successCallback();\n              let { page, limit } = this.listQuery;\n              if (page > 1 && this.total - 1 - (page - 1) * limit <= 0) {\n                this.listQuery.page -= 1;\n              }\n              this.total -= 1;\n              this.getList();\n            }\n          })\n          .catch((err) => {\n            this.failCallback(err);\n          });\n      },\n      prepareSign(){\n        this.apiLoading = true;\n        var _this = this;\n        this.$api(\"blind.box.prepare\", {\n          id: this.blindBoxId,\n          owner: this.web3.coinbase,\n        }).then(async function(res){\n          _this.apiLoading = false;\n          if(_this.$tool.checkResponse(res)){\n            var order = res.data;\n            var message = order.message;\n            message = message.replace(\"0x\", \"\");\n            var result = await web3.sign(message, _this.web3.coinbase);\n            if(result.error){\n              _this.error = result.error;\n            }\n            order.signature = result;\n            _this.signData(order);\n          }\n        });\n      },\n      signData (order) {\n        this.apiLoading = true;\n        this.$api(\"blind.box.sign\", order).then((res) => {\n          this.apiLoading = false;\n          if (this.$tool.checkResponse(res)) {\n            this.successCallback();\n            this.getList();\n          }\n        }).catch((err) => {\n          this.failCallback(err);\n        });\n      },\n      successCallback () {\n        this.$notify.success({\n          title: this.$t(\"blind.success\"),\n          message: this.$t(\"blind.messageSuccess\"),\n        });\n        this.handlerCancel();\n      },\n      failCallback (err, msg) {\n        this.apiLoading = false;\n        this.$notify.error({\n          title: this.$t(\"blind.fail\"),\n          message: err\n            ? (!msg ? this.$t(\"response.\" + err.data ? err.data.errno : \"\") : msg)\n            : this.$t(\"blind.messageFail\"),\n        });\n        if (this.dialogStatus == \"del\" || this.dialogStatus == \"sign\") {\n          this.handlerCancel();\n        }\n      },\n      callbackCloseDialog () {\n        this.resetForm();\n        this.$nextTick(function () {\n          this.$refs[\"formData\"] ? this.$refs[\"formData\"].clearValidate() : \"\";\n        });\n\n        this.dialogStatus = \"\";\n        this.error = \"\";\n      },\n      uploadChange (file, name) {\n        var event = event || window.event;\n        var files = event.target.files[0];\n        var reader = new FileReader();\n        var _this = this;\n        switch (name) {\n          case \"cover\":\n            this.filelist = [];\n            this.fileImage = file.raw;\n            reader.onload = function (e) {\n              _this.formData.imgUrl = e.target.result;\n            };\n            break;\n          case \"open\":\n            this.anim1List = [];\n            this.anim1Image = file.raw;\n            reader.onload = function (e) {\n              _this.formData.anim1 = e.target.result;\n            };\n            break;\n          case \"opened\":\n            this.anim2List = [];\n            this.anim2Image = file.raw;\n            reader.onload = function (e) {\n              _this.formData.anim2 = e.target.result;\n            };\n            break;\n        }\n        reader.readAsDataURL(files);\n      },\n      resetForm () {\n        this.formData = {\n          address: \"\",\n          name: \"\",\n          describe: \"\",\n          times: [],\n          isRepetition: false,\n          amount: \"\",\n          nftAmount: \"\",\n          price: \"\",\n          paytokenId: \"\",\n          imgId: \"\",\n          imgUrl: \"\",\n          anim1: \"\",\n          anim2: \"\",\n        };\n        this.fileImage = \"\";\n        this.anim1Image = \"\";\n        this.anim2Image = \"\";\n        this.error = \"\";\n      },\n      handlerBtn (btnType, row = {}) {\n        switch (btnType) {\n          case \"add\":\n            this.$nextTick(function () {\n              this.$refs[\"formData\"]\n                ? this.$refs[\"formData\"].clearValidate()\n                : \"\";\n            });\n            break;\n          case \"edit\":\n            this.fileImage = \"\";\n            this.anim1Image = \"\";\n            this.anim2Image = \"\";\n            this.formData = Object.assign({}, row);\n            let startTime = !this.formData.startTime\n              ? \"\"\n              : new Date(this.formData.startTime * 1000);\n            let endTime = !this.formData.endTime\n              ? \"\"\n              : new Date(this.formData.endTime * 1000);\n            this.$set(this.formData, \"times\", [startTime, endTime]);\n            this.$nextTick(function () {\n              this.$refs[\"formData\"]\n                ? this.$refs[\"formData\"].clearValidate()\n                : \"\";\n            });\n            break;\n          case \"del\":\n            this.deleteId = row.id;\n            break;\n          case \"sign\":\n            this.blindBoxId = row.id;\n            break;\n          case \"set\":\n            this.box = row;\n            break;\n        }\n        this.dialogFormVisible = true;\n        this.dialogStatus = btnType;\n      },\n      async handlerConfirm () {\n        if (this.apiLoading) return;\n\n        switch (this.dialogStatus) {\n          case \"add\":\n            if (!this.checkForm()) return;\n            var data = {};\n            if (this.fileImage) {\n              var result = await this.uploadStorage(this.fileImage);\n              data.cover = result;\n            }\n            if (this.anim1Image) {\n              var result = await this.uploadStorage(this.anim1Image);\n              data.anim1 = result;\n            }\n            if (this.anim2Image) {\n              var result = await this.uploadStorage(this.anim2Image);\n              data.anim2 = result;\n            }\n            this.addBox(data);\n            break;\n          case \"edit\":\n            if (!this.checkForm()) return;\n            var data = {};\n            if (this.fileImage) {\n              var result = await this.uploadStorage(this.fileImage);\n              data.cover = result;\n            }\n            if (this.anim1Image) {\n              var result = await this.uploadStorage(this.anim1Image);\n              data.anim1 = result;\n            }\n            if (this.anim2Image) {\n              var result = await this.uploadStorage(this.anim2Image);\n              data.anim2 = result;\n            }\n            this.editBox(data);\n            break;\n          case \"del\":\n            this.delBox();\n            break;\n          case \"sign\":\n            this.signData();\n            break;\n          case \"set\":\n            this.$nextTick(() => {\n              if (this.$refs.comSet) {\n                this.$refs.comSet.addBox();\n              }\n            });\n            break;\n        }\n      },\n      handlerCancel () {\n        this.dialogFormVisible = false;\n      },\n      async uploadStorage (file) {\n        return new Promise((resolve, reject) => {\n          const formData = new FormData();\n          formData.append(\"file\", file);\n          var that = this;\n          this.$api(\"storage.create\", formData)\n            .then((res) => {\n              if (this.$tool.checkResponse(res)) {\n                resolve(res.data);\n              } else {\n                reject(res);\n              }\n            }).catch((err) => {\n              reject(err);\n            });\n        });\n      },\n      handlerFilter () {\n        this.listQuery.page = 1;\n        this.getList();\n      },\n    },\n  };\n</script>\n\n<style lang=\"scss\" scoped>\n  .avatar-uploader .el-upload {\n    border: 1px dashed #d9d9d9;\n    border-radius: 6px;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n  }\n  .avatar-uploader .el-upload:hover {\n    border-color: #20a0ff;\n  }\n  .avatar-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 120px;\n    height: 120px;\n    line-height: 120px;\n    text-align: center;\n  }\n  .avatar {\n    width: 145px;\n    height: 145px;\n    display: block;\n  }\n\n  .property-group {\n    display: flex;\n    flex-direction: row;\n    margin-bottom: 15px;\n    .property {\n      flex: 1;\n    }\n    .left {\n      padding-right: 40px;\n    }\n  }\n  .form-tip {\n    font-weight: bold;\n    padding: 0 0 10px 120px;\n  }\n</style>\n"]}]}