{"remainingRequest":"C:\\Users\\Mohamed Tamim\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-web\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\Mohamed Tamim\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-web\\src\\components\\dialogs\\Auction.vue?vue&type=style&index=0&id=135a4edf&lang=scss&scoped=true","dependencies":[{"path":"C:\\Users\\Mohamed Tamim\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-web\\src\\components\\dialogs\\Auction.vue","mtime":1650964597000},{"path":"C:\\Users\\Mohamed Tamim\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-web\\node_modules\\css-loader\\dist\\cjs.js","mtime":1652258042074},{"path":"C:\\Users\\Mohamed Tamim\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-web\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":1652258044998},{"path":"C:\\Users\\Mohamed Tamim\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-web\\node_modules\\postcss-loader\\src\\index.js","mtime":1652258043094},{"path":"C:\\Users\\Mohamed Tamim\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-web\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1652258078791},{"path":"C:\\Users\\Mohamed Tamim\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1652258014056},{"path":"C:\\Users\\Mohamed Tamim\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-web\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1652258044998}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgLnByb2Nlc3MgLnRpcCB7CiAgICBsaW5lLWhlaWdodDogNDBweDsKICB9CiAgLnBheXRva2VuLXNlbGVjdHMgLmVsLWlucHV0IHsKICAgIGJvcmRlci1ib3R0b206IG5vbmUgIWltcG9ydGFudDsKICB9Cg=="},{"version":3,"sources":["C:\\Users\\Mohamed Tamim\\Desktop\\SONGTRADER-V2-FULL\\fingernft_blindbox\\fingernft_blindbox\\vue-web\\src\\components\\dialogs\\Auction.vue"],"names":[],"mappings":";EA0gBE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE;IACZ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACnB;EACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;IAC1B,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAChC","file":"C:/Users/Mohamed Tamim/Desktop/SONGTRADER-V2-FULL/fingernft_blindbox/fingernft_blindbox/vue-web/src/components/dialogs/Auction.vue","sourceRoot":"","sourcesContent":["<template>\n  <el-dialog :model-value=\"visible\" :show-close=\"false\" :close-on-click-modal=\"false\" custom-class=\"fg-dialog\" @open=\"onOpen\" @close=\"$emit('close')\" @closed=\"closed\">\n    <template #title>\n      <div class=\"fg-dialog-title\">\n        <div class=\"left\">\n          <span v-if=\"uri\">{{ uri.name }}</span>\n        </div>\n        <div class=\"right\" @click=\"$emit('close')\">\n          <img class=\"close-img\" src=\"@/assets/create-img/pop_shut.png \" />\n        </div>\n      </div>\n    </template>\n    <div class=\"fg-dialog-body\" v-if=\"!confirm\">\n      <div class=\"process\">\n        <div class=\"step-info\">\n          <div class=\"text\">\n            <span>{{ $t(\"dialog.auction\") }}</span>\n          </div>\n        </div>\n        <div class=\"input-group flex p-bottom-0\">\n          <div class=\"input-info w50 m-right-5\">\n            <div class=\"tip\">{{ $t('dialog.startTime')}}</div>\n            <el-date-picker prefix-icon=\"false\" v-model=\"form.startTime\" type=\"datetime\" :placeholder=\"$t('dialog.startTime')\" :clearable=\"false\">\n            </el-date-picker>\n            <div class=\"input-error\" v-if=\"formError.startTime\">\n              {{ formError.startTime }}\n            </div>\n          </div>\n          <div class=\"input-info w50\">\n            <div class=\"tip\">{{$t('dialog.endTime')}}</div>\n            <el-date-picker prefix-icon=\"false\" v-model=\"form.endTime\" type=\"datetime\" :placeholder=\"$t('dialog.endTime')\" :clearable=\"false\">\n            </el-date-picker>\n            <div class=\"input-error\" v-if=\"formError.endTime\">\n              {{ formError.endTime }}\n            </div>\n          </div>\n        </div>\n        <div class=\"tip\">\n          <span>{{$t('dialog.price')}}</span>\n        </div>\n        <div class=\"input-group\">\n          <div class=\"input-info\">\n            <el-input class=\"fg-dialog-input\" :placeholder=\"$t('dialog.startPrice')\" type=\"number\" v-model=\"form.startPrice\">\n              <template #suffix>\n                <el-select class=\"paytoken-selects\" v-model=\"form.payAddress\" v-if=\"!auction\">\n                  <el-option v-for=\"(token, i) in payTokens\" :key=\"i\" :label=\"token.symbol\" :value=\"token.address\">\n                  </el-option>\n                </el-select>\n                <span v-else>{{ payToken ? payToken.symbol : \"\" }}</span>\n              </template>\n            </el-input>\n            <div class=\"input-error\" v-if=\"formError.startPrice\">\n              {{ formError.startPrice }}\n            </div>\n          </div>\n          <div class=\"input-info m-top-10\">\n            <el-input class=\"fg-dialog-input\" :placeholder=\"$t('dialog.lowestAcceptPrice')\" type=\"number\" v-model=\"form.hopePrice\">\n              <template #suffix>\n                <span>{{ payToken ? payToken.symbol : \"\" }}</span>\n              </template>\n            </el-input>\n            <div class=\"input-error\" v-if=\"formError.hopePrice\">\n              {{ formError.hopePrice }}\n            </div>\n          </div>\n          <div class=\"input-info m-top-10\">\n            <el-input class=\"fg-dialog-input\" :placeholder=\"$t('dialog.minBidIncrement')\" type=\"number\" v-model=\"form.minRangeValue\">\n              <template #suffix>\n                <span>{{ payToken ? payToken.symbol : \"\"}}</span>\n              </template>\n            </el-input>\n            <div class=\"input-error\" v-if=\"formError.minRangeValue\">\n              {{ formError.minRangeValue}}\n            </div>\n          </div>\n          <div class=\"input-info\">\n            <div class=\"tip flex\">\n              <span>{{$t('dialog.dividendRate')}}</span>\n            </div>\n            <el-slider v-model=\"form.dividends\" class=\"fg-dialog-input\" input-size=\"small\"></el-slider>\n            <div class=\"input-error\" v-if=\"formError.dividends\">\n              {{ formError.dividends }}\n            </div>\n          </div>\n        </div>\n        <template v-if=\"$sdk.keyAssetType(nft.type) != 'ERC721'\">\n          <div class=\"tip\">\n            {{ $t(\"dialog.enterQuantity\") }}\n            <span class=\"gray-font\">\n              ({{ myAsset.quantity }} {{ $t(\"dialog.available\") }} )\n            </span>\n          </div>\n          <div class=\"input-group\">\n            <div class=\"input-info\">\n              <el-input class=\"fg-dialog-input\" placeholder=\"0\" type=\"number\" v-model=\"form.quantity\">\n              </el-input>\n              <div class=\"input-error\" v-if=\"formError.quantity\">\n                {{ formError.quantity }}\n              </div>\n            </div>\n          </div>\n        </template>\n        <div class=\"process-btn\">\n          <el-button @click=\"onSubmit\" type=\"primary\" :loading=\"confirm\">\n            {{ $t(\"dialog.confirm\") }}\n          </el-button>\n        </div>\n      </div>\n    </div>\n    <div class=\"fg-dialog-body\" v-else>\n      <div class=\"process\">\n        <div class=\"step-info\">\n          <div class=\"text\">\n            <span>{{ $t(\"dialog.approveCollection\") }}</span>\n          </div>\n          <span v-if=\"step.approve != 1\" :class=\"step.approve == 2 ? 'finish' : ''\" class=\"step iconfont icon-seleted\"></span>\n          <div class=\"step loading\" v-else>\n            <img class=\"loading-animation\" src=\"@/assets/img/loading.png\" />\n          </div>\n        </div>\n        <div class=\"process-btn\">\n          <el-button @click=\"onApprove\" type=\"primary\" v-if=\"step.approve == 0\">{{ $t(\"dialog.approve\") }}</el-button>\n          <el-button disabled type=\"info\" v-else-if=\"step.approve == 1\">{{\n            $t(\"dialog.inProgress\")\n          }}</el-button>\n          <el-button disabled type=\"info\" v-else>{{\n            $t(\"dialog.done\")\n          }}</el-button>\n        </div>\n        <div class=\"process-error\" v-if=\"error.approve\">\n          {{ error.approve }}\n        </div>\n      </div>\n      <div class=\"process\">\n        <div class=\"step-info\">\n          <div class=\"text\">\n            <span>{{ $t(\"dialog.signsAuction\") }}</span>\n          </div>\n          <span v-if=\"step.auction != 1\" :class=\"step.auction == 2 ? 'finish' : ''\" class=\"step iconfont icon-seleted\"></span>\n          <div class=\"step loading\" v-else>\n            <img class=\"loading-animation\" src=\"@/assets/img/loading.png\" />\n          </div>\n        </div>\n        <div class=\"process-btn\">\n          <el-button disabled type=\"info\" v-if=\"step.approve != 2\">{{\n            $t(\"dialog.auction\")\n          }}</el-button>\n          <el-button @click=\"onAuction\" type=\"primary\" v-else-if=\"step.auction == 0\">{{ $t(\"dialog.auction\") }}</el-button>\n          <el-button disabled type=\"info\" v-else-if=\"step.auction == 1\">\n            {{ $t(\"dialog.inProgress\") }}</el-button>\n          <el-button disabled type=\"info\" v-else>{{\n            $t(\"dialog.done\")\n          }}</el-button>\n        </div>\n        <div class=\"process-error\" v-if=\"error.auction\">{{ error.auction}}</div>\n      </div>\n    </div>\n  </el-dialog>\n</template>\n<script>\n  export default {\n    data () {\n      return {\n        visible: this.show,\n        confirm: false,\n        tag: \"form\",\n        dateVal: \"\",\n        form: {\n          startTime: \"\",\n          endTime: \"\",\n          startPrice: \"\",\n          hopePrice: \"\",\n          payAddress: \"\",\n          quantity: \"\",\n          dividends: \"\",\n          minRangeValue: \"\",\n        },\n        formError: {\n          startTime: \"\",\n          endTime: \"\",\n          startPrice: \"\",\n          hopePrice: \"\",\n          payAddress: \"\",\n          quantity: \"\",\n          dividends: \"\",\n          minRangeValue: \"\",\n        },\n        step: {\n          approve: 0,\n          auction: 0,\n        },\n        error: {\n          all: \"\",\n          approve: \"\",\n          auction: \"\",\n        },\n        order: {},\n      };\n    },\n    emits: ['confirm'],\n    props: {\n      show: {\n        type: Boolean,\n        default: true,\n      },\n      nft: {\n        type: Object,\n        default: {},\n      },\n      uri: {\n        type: Object,\n        default: {},\n      },\n      auction: {\n        type: Object,\n        default: null,\n      },\n      myAsset: {\n        type: Object,\n        default: null,\n      },\n    },\n    computed: {\n      user () {\n        return this.$store.state.user;\n      },\n      config () {\n        return this.$store.state.config;\n      },\n      payTokens () {\n        var payTokens = this.$store.state.payTokens;\n        let tokens = [];\n        for (var i = 0;i < payTokens.length;i++) {\n          let payToken = payTokens[i];\n          if (payToken.address.toLocaleLowerCase() == this.$sdk.NULL_ADDRESS().toLocaleLowerCase()) continue;\n          tokens.push(payToken);\n        }\n        return tokens;\n      },\n      payToken () {\n        let payToken = this.$store.getters.payToken(this.form.payAddress);\n        return payToken;\n      },\n    },\n    methods: {\n      onOpen () {\n        this.init();\n        if (!this.auction) {\n          if (this.$sdk.keyAssetType(this.nft.type) == \"ERC721\") {\n            this.form.quantity = \"1\";\n          } else {\n            this.form.quantity = \"\";\n          }\n        } else {\n          this.form = {\n            startTime: new Date(this.auction.startTime * 1000),\n            endTime: new Date(this.auction.endTime * 1000),\n            startPrice: this.auction.startValue,\n            hopePrice: this.auction.buying,\n            payAddress: this.$store.getters.payToken(this.auction.buyerToken).address.toLocaleLowerCase(),\n            quantity: this.auction.sellValue,\n            dividends: parseInt(this.auction.encourage / 100),\n            minRangeValue: this.auction.rangeValue,\n          }\n        }\n      },\n      optChange (val) {\n        if (val === 0) {\n          this.tag = \"date\";\n          this.dateVal = this.dateVal ? new Date(this.dateVal) : new Date();\n          this.$nextTick(function () {\n            this.$refs.date.focus();\n          });\n        }\n      },\n      formatDate (d) {\n        let str_date = \"\";\n        if (d) {\n          let d_date = d.getDate() < 10 ? \"0\" + d.getDate() : d.getDate(),\n            d_month =\n              d.getMonth() + 1 < 10 ? \"0\" + (d.getMonth() + 1) : d.getMonth() + 1;\n          let time = d.toTimeString().substr(0, 8);\n          str_date = d.getFullYear() + \"-\" + d_month + \"-\" + d_date + \" \" + time;\n        }\n        return str_date;\n      },\n      changeCallback (d) {\n        this.dateVal = this.form.endTime = this.formatDate(d);\n        this.tag = \"form\";\n      },\n      blurCallback () {\n        this.$nextTick(function () {\n          this.$refs.date.focus();\n        });\n      },\n      checkForm () {\n        var error = false;\n        this.clearFormError();\n        if (!this.form.startTime) {\n          error = true;\n          this.formError.startTime = this.$t('form.noStartTime');\n        }\n        if (!this.form.endTime) {\n          error = true;\n          this.formError.endTime = this.$t('form.noEndTime');\n        }\n        if (!parseFloat(this.form.startPrice)) {\n          error = true;\n          this.formError.startPrice = this.$t('form.noStartPrice');\n        }\n        if (!parseFloat(this.form.hopePrice)) {\n          error = true;\n          this.formError.hopePrice = this.$t('form.noLowestAcceptPrice');\n        }\n        if (\n          parseFloat(this.form.startPrice) > parseFloat(this.form.hopePrice)\n        ) {\n          error = true;\n          this.formError.hopePrice = this.$t('form.limitLowestAcceptPrice');\n        }\n        if (!parseInt(this.form.quantity)) {\n          error = true;\n          this.formError.quantity = this.$t('form.noQuantity');\n        }\n        if (parseInt(this.form.quantity) > parseInt(this.myAsset.quantity)) {\n          error = true;\n          this.formError.quantity = this.$t('form.exceedValue');\n        }\n        if (!parseFloat(this.form.minRangeValue)) {\n          error = true;\n          this.formError.minRangeValue = this.$t('form.noMinBidIncrement');\n        }\n        return !error;\n      },\n      onSubmit () {\n        if (!this.checkForm()) return;\n        this.confirm = true;\n        let that = this;\n        setTimeout(async function () {\n          await that.onApprove();\n        }, 100);\n      },\n      async onApprove () {\n        this.step.approve = 1;\n        let payToken = this.$store.getters.payToken(this.form.payAddress);\n        this.order = {\n          address: this.nft.address,\n          tokenId: this.nft.tokenId,\n          type: this.nft.type,\n          payToken: payToken,\n          salt: \"0\",\n        };\n        if (this.auction) {\n          this.order.salt = this.auction.salt;\n        }\n        let approved = await this.setApproveAll();\n        if (approved.error) {\n          this.error.approve = approved.error;\n          this.step.approve = 0;\n        } else {\n          this.error.approve = \"\";\n          this.step.approve = 2;\n        }\n      },\n      async setApproveAll () {\n        let order = {\n          type: this.order.type,\n          address: this.order.address,\n          tokenId: this.order.tokenId,\n        };\n        let isApproved = await this.$sdk.isApprovedForAll(\n          order,\n          this.user.coinbase,\n          this.config.contract.transferProxyAddress,\n        );\n        if (typeof isApproved == \"object\" && isApproved.error) {\n          return isApproved;\n        }\n        if (isApproved) return true;\n        let result = await this.$sdk.setApprovalForAll(\n          order,\n          this.user.coinbase,\n          this.config.contract.transferProxyAddress,\n          true\n        );\n        return result;\n      },\n      async onAuction () {\n        this.step.auction = 1;\n        let order = {\n          ...this.order,\n        };\n        let result = await this.auctionToken(order);\n        if (result.error) {\n          this.error.auction = result.error;\n          this.step.auction = 0;\n        } else {\n          this.error.auction = \"\";\n          this.step.auction = 2;\n          this.$emit(\"confirm\");\n        }\n      },\n      async auctionToken (order) {\n        return new Promise((resolve, reject) => {\n          let { startTime, endTime, startPrice, hopePrice, quantity } = this.form;\n          let data = {\n            owner: this.user.coinbase,\n            sellToken: order.address,\n            sellTokenId: order.tokenId,\n            sellType: order.type,\n            buyerTokenId: \"0\",\n            buyerType: order.payToken.type,\n            buyerToken: order.payToken.address,\n            buying: this.$tools.decimalsValue(hopePrice, quantity, order.payToken.decimals),\n            sellValue: quantity,\n            startValue: this.$tools.decimalsValue(startPrice, quantity, order.payToken.decimals),\n            startTime: parseInt(startTime / 1000),\n            endTime: parseInt(new Date(endTime).getTime() / 1000),\n            encourage: this.form.dividends ? this.form.dividends * 100 : 0,\n            rangeValue: this.$tools.decimalsValue(this.form.minRangeValue, 1, order.payToken.decimals),\n            salt: order.salt,\n            type: this.$tools.getNotitySubTypeCode(\"AUCTION\"),\n            id: order.id ? order.id : \"\",\n          };\n          let that = this;\n          this.$api(\"auction.prepare\", data).then(async function (res) {\n            if (that.$tools.checkResponse(res)) {\n              let { message, salt } = res.data;\n              let signature = \"\";\n              if (message.startsWith(\"0x\")) {\n                message = message.slice(2, message.length);\n              }\n              try {\n                signature = await that.$web3.sign(message, that.user.coinbase);\n                if (signature.error) {\n                  return resolve(signature);\n                }\n              } catch (e) {\n                return resolve({ error: e.message });\n              }\n              data.signature = signature;\n              data.salt = salt;\n              data.message = message;\n              data.sellerFee = that.config.sellerFee;\n              data.buyerFee = that.config.buyerFee;\n              if (!that.auction) {\n                data.type = that.$tools.getNotitySubTypeCode(\"AUCTION\");\n              } else {\n                data.type = that.$tools.getNotitySubTypeCode(\"EDIT_AUCTION\");\n              }\n\n              that.$api(\"auction.add\", data).then((res) => {\n                if (that.$tools.checkResponse(res)) {\n                  that.$tools.message(\n                    that.$t(\"request.saleSuccess\"),\n                    \"success\"\n                  );\n                  resolve(res);\n                } else {\n                  resolve({ error: res.errmsg });\n                }\n              });\n\n            } else {\n              that.$tools.message(res.errmsg);\n              resolve({ error: res.errmsg });\n            }\n          });\n        });\n      },\n      closed () {\n        this.init();\n      },\n      init () {\n        let paytoken = this.$store.getters.defaultBidPayToken();\n        this.confirm = false;\n        this.tag = \"form\";\n        this.dateVal = \"\";\n        this.form = {\n          startTime: \"\",\n          endTime: \"\",\n          startPrice: \"\",\n          hopePrice: \"\",\n          payAddress: paytoken ? paytoken.address : \"\",\n          quantity: \"\",\n          dividends: \"\",\n          minRangeValue: \"\",\n        };\n        this.step = {\n          approve: 0,\n          auction: 0,\n        };\n        this.error = {\n          all: \"\",\n          approve: \"\",\n          auction: \"\",\n        };\n        this.order = {};\n        this.clearFormError();\n      },\n      clearFormError () {\n        this.formError = {\n          startTime: \"\",\n          endTime: \"\",\n          startPrice: \"\",\n          hopePrice: \"\",\n          payAddress: \"\",\n          quantity: \"\",\n          dividends: \"\",\n          minRangeValue: \"\",\n        };\n      },\n    },\n    watch: {\n      show () {\n        this.visible = this.show;\n      },\n    },\n  };\n</script>\n\n<style lang=\"scss\" scoped>\n  .process .tip {\n    line-height: 40px;\n  }\n  .paytoken-selects .el-input {\n    border-bottom: none !important;\n  }\n</style>\n"]}]}